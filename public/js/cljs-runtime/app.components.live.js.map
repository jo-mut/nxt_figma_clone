{"version":3,"sources":["app/components/live.cljs"],"mappings":"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","names":["app.components.live/cursor-state","cljs.core.atom","app.components.live/pointer-move","update-my-presence","js/module$node_modules$react$index.useCallback","e","rect","x","y","cljs.core.swap_BANG_","cljs.core/update","state","cljs.core.assoc","app.lib.types/cursor-mode","G__14211","app.components.live/pointer-leave","G__14212","app.components.live/pointer-down","G__14213","app.components.live/view","vec__14214","cljs.core.nth","others","js/module$node_modules$$liveblocks$react$dist$suspense.useOthers","my-presence","js/module$node_modules$$liveblocks$react$dist$suspense.useMyPresence","presence","cljs.core.js__GT_clj","handlePointerMove","handlePointerLeave","handlePointerDown","cursor","cljs.core.get_in","js/module$node_modules$react$index.useEffect","on-key-up","event","cljs.core._EQ_","G__14217","on-key-down","js/window","reagent.core.as_element","app.components.cursors.cursor-chat/view","js/console.log","cljs.core/seq","app.components.cursors.live-cursors/live-cursors"],"sourcesContent":["(ns app.components.live\n  (:require\n   [app.components.cursors.live-cursors :as cursors]\n   [app.components.cursors.cursor-chat :as cursor-chat]\n   [app.lib.types :as custom]\n   [reagent.core :as r]\n   [\"react\" :as react]\n   [\"@liveblocks/react/suspense\" :refer [useOthers, useMyPresence]]))\n\n(def cursor-state (atom {:cursor-state {:message          \"\"\n                                        :previous-message \"\"\n                                        :mode             :hidden}}))\n\n(defn pointer-move\n  [update-my-presence]\n  (react/useCallback\n   (fn [e]\n     (let [rect (.getBoundingClientRect (.-currentTarget e))\n           x (- (.-clientX e) (.-x rect))\n           y (- (.-clientY e) (.-y rect))]\n       (swap! cursor-state update :cursor-state\n              (fn [state] (assoc state :mode (:hidden custom/cursor-mode))))\n       (update-my-presence #js {:cursor {:x x :y y}})))\n   [update-my-presence]))\n\n(defn pointer-leave\n  [update-my-presence]\n  (react/useCallback\n   (fn [e]\n     (.preventDefault e)\n     (update-my-presence #js {:cursor nil\n                              :message nil}))\n   [update-my-presence]))\n\n(defn pointer-down\n  [update-my-presence]\n  (react/useCallback\n   (fn [e]\n     (let [rect (.getBoundingClientRect (.-currentTarget e))\n           x (- (.-clientX e) (.-x rect))\n           y (- (.-clientY e) (.-y rect))]\n       (update-my-presence #js {:cursor {:x x :y y}})))\n   [update-my-presence]))\n\n\n\n(defn view []\n  (let [others (useOthers)\n        [my-presence update-my-presence] (useMyPresence)\n        presence (js->clj my-presence :keywordize-keys true)\n        handlePointerMove (pointer-move update-my-presence)\n        handlePointerLeave (pointer-leave update-my-presence)\n        handlePointerDown (pointer-down update-my-presence)\n        cursor (get-in presence [:cursor])]\n\n    (react/useEffect\n     (fn []\n       (let [on-key-up (fn [event]\n                         (cond\n                           (= (.-key event) \"/\")\n                           (swap! cursor-state update :cursor-state\n                                  (fn [state]\n                                    (-> state\n                                        (assoc  :previous-message nil)\n                                        (assoc  :message          \"\")\n                                        (assoc  :mode             :chat))))\n                           (= (.-key event) \"Escape\")\n                           (fn []\n                             (update-my-presence #js {:message \"\"})\n                             (swap! cursor-state :mode :hidden))))\n             on-key-down (fn [event]\n                           (when (= (-> event .-key) \"/\")\n                             (-> event .preventDefault)))]\n\n         (.addEventListener js/window \"keyup\" on-key-up)\n         (.addEventListener js/window \"keydown\" on-key-down)\n\n\n         (fn []\n           (.removeEventListener js/window \"keyup\" on-key-up)\n           (.removeEventListener js/window \"keydown\" on-key-down))))\n\n     [update-my-presence])\n\n    (r/as-element\n     [:div {:on-pointer-move handlePointerMove\n            :on-pointer-leave handlePointerLeave\n            :on-pointer-down handlePointerDown\n            :className \"h-[100vh] w-full flex justify-center items-center \n                                        text-center border border-2 border-cyan-500\"}\n      (when cursor\n        [cursor-chat/view\n         {:cursor cursor\n          :cursor-state cursor-state\n          :update-my-presence update-my-presence}])\n      (js/console.log \"others lives ******\"  others)\n      (when (seq others)\n        [cursors/live-cursors  {:others others}])])))"]}